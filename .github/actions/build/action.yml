name: Build the solution with MSBuild

inputs:
  platform:
    description: "Build platform (architecture)"
    required: true
    type: string

  configuration:
    description: "Build configuration"
    required: true
    type: string

outputs:
  artifact-id:
    description: "ID of the artifact containing the built files"
    value: ${{ steps.upload.outputs.artifact-id }}

  artifact-url:
    description: "URL of the artifact containing the built files"
    value: ${{ steps.upload.outputs.artifact-url }}

permissions:
  contents: read

runs:
  using: composite
  steps:
    - name: Set variables
      id: vars
      shell: bash
      run: >
        echo
        "build_directory=build/${{ inputs.platform }}-${{ inputs.configuration }}"
        >> "$GITHUB_OUTPUT"

    - name: Checkout submodules
      shell: bash
      run: |
        git submodule update --init --recursive

    - name: Configure
      shell: bash
      run: >
        cmake
        -S .
        -B ${{ steps.vars.outputs.build_directory }}
        -A ${{ inputs.platform }}
        -DCMAKE_BUILD_TYPE=${{ inputs.configuration }}

    - name: Build
      shell: bash
      run: |
        cmake --build ${{ steps.vars.outputs.build_directory }}

    - name: Upload artifact with built files
      id: upload
      uses: actions/upload-artifact@v4
      with:
        name: ${{ inputs.platform }}.${{ inputs.configuration }}
        path: mod/
